/*
* Infragistics.Web.ClientUI igGrid KnockoutJS extension 12.2.20122.1021
*
* Copyright (c) 2011-2012 Infragistics Inc.
*
* http://www.infragistics.com/
*
* Depends on:
*	jquery-1.7.1.js
*	ig.util.js
*	ig.dataSource.js
*	ig.ui.grid.framework.js
*/
ko.bindingHandlers.igGrid={init:function(f,p,a,q,c){var i=$(f),j=i.data("igGrid"),b,n,l,k,h,m,e;if(i.attr("data-create")!=="false"){b=ko.utils.unwrapObservable(p());n={};n.dataSource=new $.ig.KnockoutDataSource({dataSource:b.dataSource});for(l in b){if(b.hasOwnProperty(l)&&l!=="dataSource"){n[l]=b[l]}}}else{b=n=j.options}k=function(o,d){var r=d.owner.options,g,s;g=ko.isObservable(b.dataSource)?b.dataSource():b.dataSource;if(g instanceof $.ig.DataSource){s=g.settings;g=g.kods?ko.isObservable(g.kods)?g.kods():g.kods:g.data();if(s.responseDataKey){if(ko.isObservable(g[s.responseDataKey])){g=g[s.responseDataKey]()}else{g=g[s.responseDataKey]}}}i.attr("data-bound",true);if(!r.rowVirtualization&&!r.virtualization){d.owner._startRowIndex=0}d.owner.element.children("tbody").children("tr").map(function(t){$(this).children().map(function(v){var u=g[t+d.owner._startRowIndex][r.columns[v].key];if(ko.isObservable(u)){ko.applyBindingsToNode(this,{igCell:{value:r.columns[v].key}},u)}})});i.removeAttr("data-bound")};i.bind("iggriddatarendered",k).bind("iggridvirtualrecordsrender",k);if(i.attr("data-create")!=="false"){i.igGrid(n)}else{h=i.data("igGrid");m=h.options;e=h.dataSource.kods;if(m.responseDataKey&&e[m.responseDataKey]){e=e[m.responseDataKey]}e=ko.isObservable(e)?e():e;i.attr("data-bound",true);i.find("tbody").children("tr").map(function(d){$(this).children().map(function(o){var g=e[d][m.columns[o].key];if(ko.isObservable(g)){ko.applyBindingsToNode(this,{igCell:{value:m.columns[o].key}},g)}})});i.removeAttr("data-bound")}return{controlsDescendantBindings:true}},update:function(c,m,a,n,b){var d=$(c).data("igGrid"),f,h,j=$(c).data("igGridUpdating"),e,k,l,g;f=m().dataSource;h=d.dataSource.data();if(j===null||j===undefined){throw new Error("two-way adding and deleting of rows with KnockoutJS requires the Updating feature to be defined")}if(typeof(f)==="function"){if(f().length!==h.length){d.dataSource._koUpdate=true}if(f().length<h.length){k=f()[f().length-1][d.options.primaryKey];k=ko.isObservable(k)?k():k;if(k===h[h.length-1][d.options.primaryKey]){for(e=0;e<h.length;e++){l=f()[e][d.options.primaryKey];l=ko.isObservable(l)?l():l;if(h[e][d.options.primaryKey]!==l){j.deleteRow(h[e][d.options.primaryKey]);break}}}else{j.deleteRow(h[h.length-1][d.options.primaryKey])}}else{if(f().length>h.length){k=f()[f().length-1][d.options.primaryKey];k=ko.isObservable(k)?k():k;if(k===h[h.length-1][d.options.primaryKey]){for(e=0;e<h.length;e++){l=f()[e][d.options.primaryKey];l=ko.isObservable(l)?l():l;if(h[e][d.options.primaryKey]!==l){j.addRow(ko.mapping.toJS(f()[e]));break}}}else{g=ko.mapping.toJS(f()[f().length-1]);j.addRow(g)}}}}}};ko.visitPropertiesOrArrayEntries=function(c,d){var a,b;if(c instanceof Array){for(a=0;a<c.length;a++){d(a)}}else{for(b in c){if(c.hasOwnProperty(b)){d(b)}}}};ko.bindingHandlers.igHierarchicalGrid={init:function(f,m,a,n,c){var g=$(f),b,i,e,j,k=0,l,d,h;b=ko.utils.unwrapObservable(m());i={};e=ko.isObservable(b.dataSource)?b.dataSource():b.dataSource;if(e instanceof $.ig.DataSource){e=e.data()}i.dataSource=new $.ig.KnockoutDataSource({dataSource:b.dataSource});for(h in b){if(b.hasOwnProperty(h)&&h!=="dataSource"){i[h]=b[h]}}g.igHierarchicalGrid(i);g.data("observableDataSource",i.dataSource);d=function(p,o){var q,s=o.options,r;q=o.owner.element.data("observableDataSource");r=q.dataAt(o.id,o.path);s.dataSource=new $.ig.KnockoutDataSource({primaryKey:s.primaryKey,dataSource:s.dataSource,observableDataSource:r,responseDataKey:s.responseDataKey});o.element.igGrid(s);s=o.element.data("igGrid").options;o.element.attr("data-create",false);ko.applyBindingsToNode(o.element,{igGrid:{}},r)};g.delegate("table","igchildgridcreating",d);j=g.data("igGrid").options;g.attr("data-bound",true);g.children("tbody").children("tr").map(function(o){$(this).children().map(function(p){l=$(this);if(!l.attr("data-skip")&&!l.hasClass("ui-iggrid-expandcolumn")){ko.applyBindingsToNode(this,{igCell:{value:j.columns[p-k].key}},e[o][j.columns[p-k].key])}else{k++}});k=0});g.removeAttr("data-bound");return{controlsDescendantBindings:true}},update:function(c,d,a,e,b){}};ko.bindingHandlers.igCell={init:function(c,d,a,e,b){},update:function(d,j,a,k){var b=$(d),e=b.closest(".ui-iggrid-table"),g,i,h,f,c;if(e.attr("data-bound")!=="true"){g=e.data("igGrid")._renderCell(k,j().value);b.text(g);i=b.closest("tr");c=e.data("igGrid").columnByKey(e.data("igGrid").options.primaryKey);if(i.attr("data-id")!==null&&i.attr("data-id")!==undefined){if(c.dataType==="number"||c.dataType===undefined){f=parseInt(i.attr("data-id"),10)}else{f=i.attr("data-id")}h=e.data("igGrid").dataSource.findRecordByKey(f);h[j().value]=k}else{throw new Error("Updating the data source requires a primary key to be defined")}}}};(function(a){a(document).ready(function(){var b=a("#__ig_wm__").length>0?a("#__ig_wm__"):a('<div id="__ig_wm__"></div>').appendTo(document.body);b.css({position:"fixed",bottom:0,right:0,zIndex:1000}).addClass("ui-igtrialwatermark")})}(jQuery));